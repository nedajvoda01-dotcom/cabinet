# AGENTS.md — правила проекта

## 0) CORE GOAL
Ты помогаешь редактировать проект “cabinet”. Проект — локальный/Pages-сайт на чистом HTML/CSS/JS (без фреймворков). Код всегда разделён на BLOCK-и. Любые изменения делаются блоками.

## 1) OUTPUT FORMAT (самое важное)
1.1 Всегда отвечай ТОЛЬКО изменёнными BLOCK-ами целиком.
1.2 Формат ответа:
- "BLOCK N) <NAME>"
- затем полный код блока (без вырезаний).
1.3 Если блок не менялся — НЕ показывай его.
1.4 Никаких частичных диффов, никаких кусочков кода.
1.5 В конце ответа — ЧЕКЛИСТ: что проверили и почему это не ломает другие части.

## 2) BLOCK DISCIPLINE
2.1 Нумерация и названия блоков сохраняются.
2.2 Новый функционал = новый BLOCK (следующий свободный номер).
2.3 Запрещено:
- смешивать ответственность блоков
- тянуть логику из доменного блока во view
2.4 Паттерн:
- Domain = чистая логика, без DOM и side-effects
- Infra = storage/IO
- App = use-cases/сервисы
- View = DOM/рендер/события
- Main = сборка всего

## 3) DESIGN TOKENS / COLORS (жёсткое правило)
3.1 В проекте НЕЛЬЗЯ писать цвета руками.
3.2 Можно использовать только токены из :root:
--c-black, --c-white, --c-gray-dark, --c-gray, --c-gray-light
3.3 Акцентные (оранжевый + градиент) — ТОЛЬКО если пользователь явно разрешил.
3.4 Если нужен новый оттенок — сначала спросить, потом добавлять как токен.
3.5 Проверяй контраст: белый текст на чёрном; тёмный текст на светлом; избегай “серый на сером”.
3.6 Палитра токенов и градиента (значения менять нельзя):
- --c-black: #000000 (RGB 0,0,0)
- --c-white: #F9F9F9 (RGB 249,249,249)
- --c-gray-dark: #333333 (RGB 51,51,51)
- --c-gray: #646464 (RGB 100,100,100)
- --c-gray-light: #A7A7A7 (RGB 167,167,167)
- --c-orange: #E85002 (RGB 232,80,20) — только по команде владельца
- --g-1: #000000
- --g-2: #C10801
- --g-3: #F16001
- --g-4: #D9C3AB
3.7 Роли цветов: основной фон страниц — --c-white; фон меню/тёмных блоков — --c-black; разделение зон — --c-gray-light умеренно; основной текст на светлом — --c-black; вторичный текст — --c-gray; третичный/disabled — --c-gray-light; текст на тёмном — --c-white; подчёркивания/детали — --c-gray-dark; границы на тёмном фоне — #2a2a2b или --c-gray-dark; на светлом — --c-gray-light или --c-gray; hover тёмных элементов — --c-gray-dark; active/selected — --c-gray; hover/active на светлом — только серыми.

## 4) ASSETS / SVG SOURCES (обязательно)
4.1 Если задача использует конкретные SVG/иконки/картинки: пользователь обязан дать ссылки/строки (data:image/svg+xml;base64,...).
4.2 Ты ОБЯЗАН: вынести ассеты в константы в отдельном блоке или в начале блока фичи; использовать ТОЛЬКО их; НЕ менять base64/контент ассета; НЕ придумывать новые ассеты.
4.3 В ответе всегда указывай, где лежат эти константы (BLOCK + имена).

## 5) SIDEBAR STATE RULES
5.1 SidebarDomain/Infra/App — не ломать без прямой команды.
5.2 SidebarView отвечает только за DOM + события и зовёт сервисы/модули.
5.3 Любой новый визуальный сценарий сайдбара реализуется отдельным модулем (BLOCK) и подключается через SidebarView.render(state).

## 6) PAGE LOADING / 404 RULES
6.1 404 показывается ТОЛЬКО если fetch по пути страницы дал ошибку (нет файла / не ok).
6.2 Нельзя вручную вызывать 404 как отдельную страницу.
6.3 404 НЕ имеет особых прав: если кнопка/фича заблокирована для страниц, то на 404 она тоже заблокирована.

## 7) BOOKMARK / FAVORITES RULES (кнопка “в избранное”)
7.1 Состояния кнопки: DISABLED (серый) — если страницу нельзя добавлять; ENABLED (чёрный) — если можно добавить, но сейчас не добавлена; ACTIVE (оранжевый разрешённый) — если страница уже в избранном.
7.2 Никаких контейнеров-обёрток ради позиционирования кнопки.
7.3 Позиционка кнопки: визуально справа от меню (в белой области); двигается синхронно с меню при collapse/expand; верх кнопки выровнен по верхнему краю SVG-лого в collapsed-режиме.

## 8) FILTERING / DATA RULES (CSV авто)
8.1 Источники данных: /data/active/autoru_car_active.csv и /data/removed/autoru_car_removed.csv.
8.2 Данные делятся на 2 списка: Активные и Снятые.
8.3 Фильтры используют ТОЛЬКО поля, которые есть в UI (нельзя выдумывать новые).
8.4 Логика каскадных фильтров: каждый выбранный фильтр сужает датасет; оставшиеся варианты в остальных фильтрах пересчитываются по остатку.
8.5 Кнопка поиска показывает: “Показать N объявлений”, где N = количество объявлений, подходящих под текущие фильтры.
8.6 Карточки авто грузятся ТОЛЬКО после нажатия кнопки “Показать N объявлений”.
8.7 В карточке отображается ВСЯ инфа из CSV + кнопка “Перейти к объявлению”.

## 9) SAFETY / COMPATIBILITY
9.1 Любое изменение должно быть backward-compatible: не ломать существующие id/class; не менять вызовы других блоков без нужды.
9.2 Если есть риск поломки: объясни где риск и предложи безопасный вариант в рамках блоков.

## 10) TESTING / SELF-CHECK
10.1 Перед финальным ответом мысленно прогоняй сценарии: collapse/expand; переходы страниц; 404 при отсутствии файла; добавление/удаление из избранного; фильтры с каскадом; “показать N объявлений”.
10.2 Если чего-то нет в коде — говори явно и оставляй TODO в соответствующем BLOCK.
10.3 Всегда добавляй блок “Проверка” в финальном ответе с выводом OK / найдено что-то.