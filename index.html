<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>ООО "ТМЫВ ДЕНЕГ" – Кабинет</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- UI font (ChatGPT-ish) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #ffffff;

      /* Тёмный сайдбар как у ChatGPT */
      --surface: #1a1a1b;
      --border: #2a2a2b;

      --text: #f3f4f6;
      --text-muted: #9ca3af;

      --item-hover: #232324;
      --item-active: #2b2d31;
      --item-active-text: #ffffff;

      --radius-md: 12px;

      --sidebar-w: 260px;
      --sidebar-w-collapsed: 48px;

      --font-ui: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      --font-ui-alt: "Inter", var(--font-ui);

      --font-logo: "HandelGothic BT Rus By Me", var(--font-ui-alt);

      --logo-font-size-base: 20px;

      /* BAN accent */
      --ban-red: #ff3b30;

      /* ВЫСОТА ЗОНЫ ЛОГО (чтобы nav не прыгал) */
      --logo-area-h: 76px;

      /* ТВОЁ base64-лого для свернутого состояния */
      --collapsed-logo-data: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik0yIDd2OGEyIDIgMCAwIDAgMiAyaDFNMiA3VjVhMiAyIDAgMCAxIDItMmgyTTIgN2E0IDQgMCAwIDAgNC00bTAgMGgxM20tOS4yMzYgOUEzIDMgMCAwIDEgMTQgNy43NjRNMiAyMEwyMCAybTEuMjIgMTYuMDQ3bC41NDktNi4yNjFjLjA3NS0uODY1LS41OTgtMS42My0xLjUwNC0xLjcwbC0uODItLjA3MW0xLjc3NiA4LjA0MmwtLjEzNyAxLjU2NmMtLjA3Ni44NjQtLjg3MiAxLjUwMS0xLjc3OCAxLjQyMmwtMS42NC0uMTQ0bTMuNTU1LTIuODQ0Yy0xLjgxMy0uMTU4LTMuNDA1IDEuMTE1LTMuNTU2IDIuODQ0bTAgMEw3IDE5Ljk1OG00LjM0Ny0zLjQ3N2MuNDA5LjUyLjk0Ljc4NSAxLjY3Ljg0OWMxLjM1OS4xMTkgMi41NTMtLjgzNiAyLjY2Ni0yLjEzM2MuMDYxLS42OTYtLjA4NS0xLjI2OS0uNTUxLTEuNzQzIi8+PC9zdmc+");
    }

    @font-face{
      font-family: "HandelGothic BT Rus By Me";
      src:
        local("HandelGothicBTRusbyme-Regular"),
        local("HandelGothic BT [Rus by me] Regular"),
        url("./fonts/HandelGothicBTRusbyme-Regular.woff2") format("woff2"),
        url("./fonts/HandelGothicBTRusbyme-Regular.woff") format("woff"),
        url("./fonts/HandelGothicBTRusbyme-Regular.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--font-ui-alt);
      background: var(--bg);
      color: #111827;
      min-height: 100vh;
    }
    .layout {
      display: flex;
      width: 100%;
      min-height: 100vh;
    }

    .sidebar {
      width: var(--sidebar-w);
      background: var(--surface);
      border-right: 1px solid var(--border);
      position: fixed;
      inset: 0 auto 0 0;
      padding: 16px 0 12px;
      display: flex;
      flex-direction: column;
      transition: width 160ms ease, padding 160ms ease;
      color: var(--text);
    }
    .sidebar.is-collapsed {
      width: var(--sidebar-w-collapsed);
      padding: 16px 0 12px;
    }

    .main {
      margin-left: var(--sidebar-w);
      width: calc(100% - var(--sidebar-w));
      min-height: 100vh;
      background: var(--bg);
      transition: margin-left 160ms ease, width 160ms ease;
      color: #111827;
    }
    .sidebar.is-collapsed ~ .main {
      margin-left: var(--sidebar-w-collapsed);
      width: calc(100% - var(--sidebar-w-collapsed));
    }

    /* ======================================================
       Logo area (фиксируем высоту, чтобы nav не прыгал)
       ====================================================== */

    .logo-area{
      height: var(--logo-area-h);
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 0 10px;
    }

    .logo-wrap {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: center;
      gap: 6px;

      width: 100%;
      padding: 8px 10px;

      border-radius: var(--radius-md);
      user-select: none;

      white-space: nowrap;
      overflow: hidden;
    }

    .logo-main {
      font-family: var(--font-logo);
      font-size: var(--logo-font-size-base);
      font-weight: 700;
      letter-spacing: 0.2px;
      line-height: 1.2;
      color: var(--text);

      width: 100%;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      min-height: 1.2em;
    }

    .logo-main .ban {
      color: var(--ban-red);
      display: inline-block;
    }

    .logo-pill {
      font-size: 11px;
      font-weight: 700;

      color: var(--text);
      background: var(--surface);
      border: 1px solid var(--text);

      border-radius: 9px;
      padding: 3px 9px 2px;
      line-height: 1;
      text-transform: lowercase;

      align-self: flex-end;
      display: inline-flex;
      align-items: center;
      justify-content: center;

      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 280ms ease-out, transform 280ms ease-out;
      pointer-events: none;
    }
    .logo-pill.is-revealed{
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }
    .logo-pill span{
      display:block;
      transform: translateY(-1px);
    }

    /* Лого при свороте — маска base64, но в той же зоне высоты */
    .logo-collapsed {
      position: absolute;
      inset: 0;
      display: none;
      width: 100%;
      background: transparent;
      color: var(--text);
      align-items: center;
      justify-content: center;
      user-select: none;
    }
    .logo-collapsed::before{
      content:"";
      width: 18px;
      height: 18px;
      background-color: currentColor;

      -webkit-mask-image: var(--collapsed-logo-data);
      mask-image: var(--collapsed-logo-data);
      -webkit-mask-repeat: no-repeat;
      mask-repeat: no-repeat;
      -webkit-mask-position: center;
      mask-position: center;
      -webkit-mask-size: contain;
      mask-size: contain;
    }

    .sidebar.is-collapsed .logo-wrap { display: none; }
    .sidebar.is-collapsed .logo-collapsed { display: flex; }

    /* ======================================================
       Nav
       ====================================================== */
    .nav {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 18px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 8px;

      margin: 0 5px;
      padding: 8px 10px;

      border-radius: 12px;
      color: var(--text);
      text-decoration: none;

      font-size: 13px;
      font-weight: 400;

      transition: background 120ms ease, color 120ms ease, transform 40ms ease;
      white-space: nowrap;
      outline: none;

      overflow: hidden;
    }

    .nav-item .ico {
      width: 19px; min-width: 19px; height: 19px;
      display: flex; align-items: center; justify-content: center;
      color: currentColor;
      flex: 0 0 19px;
    }
    .nav-item .ico svg {
      width: 18px; height: 18px;
      stroke: currentColor; fill: none;
    }

    .nav-item .text{
      display: inline-block;
      transition: opacity 140ms ease, transform 140ms ease, width 140ms ease;
      transform: translateX(0);
      opacity: 1;
      width: auto;
      overflow: hidden;
    }

    .sidebar.is-collapsed .nav-item .text{
      opacity: 0;
      transform: translateX(-6px);
      width: 0;
      pointer-events: none;
    }

    .nav-item:hover { background: var(--item-hover); }
    .nav-item:active { transform: translateY(1px); }

    .nav-item.is-active {
      background: var(--item-active);
      color: var(--item-active-text);
      font-weight: 500;
    }

    .divider {
      height: 1px; background: var(--border);
      margin: 10px 4px; border-radius: 1px;
    }

    .collapse-row {
      margin-top: auto;
      padding: 4px 6px;
      display: flex; align-items: center; gap: 4px;
      justify-content: flex-end; text-align: right;
      width: fit-content; align-self: flex-end;

      color: var(--text-muted);
      font-size: 13px;
      cursor: pointer; user-select: none;
      border-radius: 8px;
      transition: color 120ms ease;
      background: transparent; border: none;
      margin-right: 5px;
    }
    .collapse-row:hover { color: var(--text); }

    .collapse-ico {
      width: 18px; height: 18px; color: currentColor;
      display: inline-flex; align-items: center; justify-content: center;
      flex: 0 0 18px;
    }
    .collapse-ico svg { width:18px;height:18px; }

    .collapse-text { font-size: 13px; white-space: nowrap; }

    .sidebar.is-collapsed .collapse-row{
      justify-content:center; align-self:center; width:100%;
      padding-left:0; padding-right:0; gap:0; text-align:center; margin-right:0;
    }
    .sidebar.is-collapsed .collapse-text{ display:none; }

    @media (prefers-reduced-motion: reduce){
      .logo-pill{ transition:none; opacity:1; transform:none; }
      .nav-item .text{ transition:none; }
    }
  </style>
</head>
<body>
  <div id="app" class="layout"></div>

  <script type="module">
    const ICONS = {
      search: `
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
             viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-linecap="round" stroke-width="2" aria-hidden="true">
          <path d="m21 21l-4.486-4.49M19 10.5a8.5 8.5 0 1 1-17 0a8.5 8.5 0 0 1 17 0Z"/>
        </svg>
      `,
      folder: `
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
             viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true">
          <path d="M22 19V9a2 2 0 0 0-2-2h-6.764a2 2 0 0 1-1.789-1.106l-.894-1.788A2 2 0 0 0 8.763 3H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2"/>
        </svg>
      `,
      chevronLeftSmall: `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M14.5 7.5L9.5 12l5 4.5"></path>
        </svg>
      `,
      chevronRightSmall: `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M9.5 7.5l5 4.5l-5 4.5"></path>
        </svg>
      `
    };

    const SidebarDomain = (() => {
      function createState({ items, activeId, collapsed = false } = {}) {
        if (!Array.isArray(items) || items.length === 0) {
          throw new Error("SidebarState: items must be a non-empty array");
        }
        const hasActive = items.some(i => i.id === activeId);
        const initialActiveId = hasActive ? activeId : items[0].id;
        return { items, activeId: initialActiveId, collapsed: Boolean(collapsed) };
      }
      function setActive(state, id) {
        if (!state.items.some(i => i.id === id)) return state;
        return { ...state, activeId: id };
      }
      function toggleCollapsed(state) { return { ...state, collapsed: !state.collapsed }; }
      return { createState, setActive, toggleCollapsed };
    })();

    const SidebarInfra = (() => {
      const KEY = "ehala.sidebar.v1";
      function createLocalStorageAdapter() {
        return {
          load() {
            try { const raw = localStorage.getItem(KEY); return raw ? JSON.parse(raw) : null; }
            catch { return null; }
          },
          save(data) {
            try { localStorage.setItem(KEY, JSON.stringify(data)); } catch {}
          },
        };
      }
      return { createLocalStorageAdapter };
    })();

    const SidebarApp = (() => {
      const { createState, setActive, toggleCollapsed } = SidebarDomain;
      function createService({ storageAdapter } = {}) {
        let state = null;
        const listeners = new Set();
        const notify = () => listeners.forEach(fn => fn(state));

        function init({ items, defaultActiveId }) {
          const saved = storageAdapter?.load?.() || null;
          state = createState({
            items,
            activeId: saved?.activeId ?? defaultActiveId,
            collapsed: saved?.collapsed ?? false,
          });
          storageAdapter?.save?.({ activeId: state.activeId, collapsed: state.collapsed });
          notify();
        }

        function onChange(listener) { listeners.add(listener); return () => listeners.delete(listener); }
        function selectItem(id) {
          state = setActive(state, id);
          storageAdapter?.save?.({ activeId: state.activeId, collapsed: state.collapsed });
          notify();
        }
        function toggle() {
          state = toggleCollapsed(state);
          storageAdapter?.save?.({ activeId: state.activeId, collapsed: state.collapsed });
          notify();
        }
        function getState() { return state; }
        return { init, onChange, selectItem, toggle, getState };
      }
      return { createService };
    })();

    const SidebarUI = (() => {
      function createView({ service }) {
        let rootEl = null;

        let typingTimer = null;
        let isTyping = false;
        let lastCollapsed = null;

        let lastScenarioIndex = -1;
        let tokens = [];

        let startDelayTimer = null;

        function mount(container) {
          rootEl = document.createElement("div");
          rootEl.innerHTML = `
            <aside class="sidebar" id="sidebar">

              <div class="logo-area">
                <div class="logo-wrap" id="logoWrap">
                  <div class="logo-main" id="logoMain"></div>
                  <div class="logo-pill" id="logoPill"><span>кабинет</span></div>
                </div>
                <div class="logo-collapsed" aria-hidden="true"></div>
              </div>

              <nav class="nav" id="nav"></nav>

              <div class="divider"></div>
              <button class="collapse-row" id="collapseBtn" type="button" aria-expanded="true">
                <span class="collapse-ico" aria-hidden="true"></span>
                <span class="collapse-text">Свернуть</span>
              </button>
            </aside>
            <main class="main" id="main"></main>
          `;
          container.appendChild(rootEl);

          wireEvents();
          service.onChange(render);
          render(service.getState());

          window.addEventListener("resize", () => {
            const sidebar = rootEl.querySelector("#sidebar");
            if (sidebar && !sidebar.classList.contains("is-collapsed")) fitLogoToOneLine();
          });
        }

        function render(state) {
          const sidebar = rootEl.querySelector("#sidebar");
          const nav = rootEl.querySelector("#nav");
          const collapseBtn = rootEl.querySelector("#collapseBtn");
          const collapseText = rootEl.querySelector(".collapse-text");
          const collapseIco = rootEl.querySelector(".collapse-ico");

          sidebar.classList.toggle("is-collapsed", state.collapsed);
          collapseBtn.setAttribute("aria-expanded", String(!state.collapsed));

          if (collapseIco) {
            collapseIco.innerHTML = state.collapsed
              ? ICONS.chevronRightSmall
              : ICONS.chevronLeftSmall;
          }
          if (collapseText) {
            collapseText.textContent = state.collapsed ? "Развернуть" : "Свернуть";
          }

          nav.innerHTML = state.items.map(item => {
            const active = item.id === state.activeId;
            const svg = ICONS[item.iconKey] || "";
            return `
              <a class="nav-item ${active ? "is-active" : ""}" href="#" data-id="${item.id}">
                <span class="ico" aria-hidden="true">${svg}</span>
                <span class="text">${item.label}</span>
              </a>
            `;
          }).join("");

          handleLogoCycle(state);
          lastCollapsed = state.collapsed;
        }

        function handleLogoCycle(state){
          const sidebar = rootEl.querySelector("#sidebar");
          const logoPill = rootEl.querySelector("#logoPill");
          if (!sidebar || !logoPill) return;

          if (state.collapsed){
            cancelStartDelay();
            stopTyping();
            clearTokens();
            renderTokens();
            resetLogoFontSize();
            logoPill.classList.remove("is-revealed");
            return;
          }

          if (lastCollapsed === null){
            scheduleTypingStart();  // ✅ 0.3s
            return;
          }

          if (lastCollapsed === true && state.collapsed === false){
            cancelStartDelay();
            stopTyping();
            clearTokens();
            renderTokens();
            resetLogoFontSize();
            logoPill.classList.remove("is-revealed");

            waitSidebarFullyOpen(sidebar, () => {
              scheduleTypingStart(); // ✅ 0.3s после полного открытия
            });
          }
        }

        function waitSidebarFullyOpen(sidebarEl, cb){
          const onEnd = (e) => {
            if (e.propertyName !== "width") return;
            sidebarEl.removeEventListener("transitionend", onEnd);
            cb();
          };
          sidebarEl.addEventListener("transitionend", onEnd);
        }

        function scheduleTypingStart(){
          cancelStartDelay();
          startDelayTimer = setTimeout(() => {
            startDelayTimer = null;
            if (!service.getState().collapsed) {
              startScenarioTyping();
            }
          }, 300); // ✅ было 1000
        }

        function cancelStartDelay(){
          if (startDelayTimer){
            clearTimeout(startDelayTimer);
            startDelayTimer = null;
          }
        }

        function clearTokens(){ tokens = []; }
        function pushChar(char, className=null){
          const last = tokens[tokens.length - 1];
          if (last && last.className === className) last.text += char;
          else tokens.push({ text: char, className });
        }
        function popChar(){
          const last = tokens[tokens.length - 1];
          if (!last) return;
          last.text = last.text.slice(0, -1);
          if (!last.text) tokens.pop();
        }

        function renderTokens(){
          const logoMain = rootEl.querySelector("#logoMain");
          if (!logoMain) return;
          logoMain.innerHTML = tokens.map(t => {
            if (!t.className) return escapeHtml(t.text);
            return `<span class="${t.className}">${escapeHtml(t.text)}</span>`;
          }).join("");
          fitLogoToOneLine();
        }

        function escapeHtml(s){
          return s.replace(/[&<>"']/g, (c) => ({
            "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
          }[c]));
        }

        function resetLogoFontSize(){
          const logoMain = rootEl.querySelector("#logoMain");
          if (!logoMain) return;
          logoMain.style.fontSize = "";
        }

        function fitLogoToOneLine(){
          const logoMain = rootEl.querySelector("#logoMain");
          if (!logoMain) return;

          resetLogoFontSize();
          const base = parseFloat(getComputedStyle(logoMain).fontSize);
          let size = base;
          const minFont = 12;
          const step = 0.5;

          requestAnimationFrame(() => {
            while (logoMain.scrollWidth > logoMain.clientWidth && size > minFont) {
              size -= step;
              logoMain.style.fontSize = size + "px";
            }
          });
        }

        // ====== 11 СЦЕНАРИЕВ ЛОГО
        function getScenario(index){
          const tailFull = [{ kind:"type", text:"ООО «ТМЫВ ДЕНЕГ»" }];
          const scenarios = [
            { steps:[
              { kind:"type", text:"ОАО" }, { kind:"wait", ms:220 },
              { kind:"backspace", count:2 }, { kind:"wait", ms:140 },
              { kind:"type", text:"ОО" }, { kind:"wait", ms:240 },
              { kind:"type", text:" «ТМЫВ ДЕНЕГ»" }
            ]},
            { steps:[
              { kind:"type", text:"АО" }, { kind:"wait", ms:260 },
              { kind:"backspace", count:2 }, { kind:"wait", ms:170 },
              { kind:"type", text:"ООО" }, { kind:"wait", ms:220 },
              { kind:"type", text:" «ТМЫВ ДЕНЕГ»" }
            ]},
            { steps:[
              { kind:"type", text:"ООО" }, { kind:"wait", ms:220 },
              { kind:"type", text:" «тмыв" }, { kind:"wait", ms:180 },
              { kind:"backspace", count:4 }, { kind:"wait", ms:260 },
              { kind:"type", text:"ТМЫВ" }, { kind:"wait", ms:200 },
              { kind:"type", text:" ДЕНЕГ»" }
            ]},
            { steps:[
              { kind:"type", text:"ООО" }, { kind:"wait", ms:220 },
              { kind:"type", text:" «тм" }, { kind:"wait", ms:160 },
              { kind:"backspace", count:2 }, { kind:"wait", ms:240 },
              { kind:"type", text:"ТМЫВ" }, { kind:"wait", ms:200 },
              { kind:"type", text:" ДЕНЕГ»" }
            ]},
            { steps:[
              { kind:"type", text:"ООО" }, { kind:"wait", ms:200 },
              { kind:"type", text:" «ТМЬ" }, { kind:"wait", ms:160 },
              { kind:"backspace", count:1 }, { kind:"wait", ms:120 },
              { kind:"type", text:"ЫВ" }, { kind:"wait", ms:220 },
              { kind:"type", text:" ДЕНЕГ»" }
            ]},
            { steps:[
              { kind:"type", text:"ООО" }, { kind:"wait", ms:220 },
              { kind:"type", text:" «ТМЫВ " }, { kind:"wait", ms:140 },
              { kind:"type", text:"ДЕБ" }, { kind:"wait", ms:120 },
              { kind:"backspace", count:1 }, { kind:"wait", ms:130 },
              { kind:"type", text:"НЕГ»" }
            ]},
            { steps:[
              { kind:"type", text:"ООО" }, { kind:"wait", ms:200 },
              { kind:"type", text:" «ТМЫВ ДЕНЕГ" }, { kind:"wait", ms:220 },
              { kind:"backspace", count:2 }, { kind:"wait", ms:140 },
              { kind:"type", text:"ЕГ»" }
            ]},
            { steps:[
              { kind:"type", text:"ООО«" }, { kind:"wait", ms:200 },
              { kind:"backspace", count:1 }, { kind:"wait", ms:140 },
              { kind:"type", text:" «ТМЫВ ДЕНЕГ»" }
            ]},
            { steps:[
              { kind:"type", text:"ООО" }, { kind:"wait", ms:180 },
              { kind:"type", text:' "' }, { kind:"wait", ms:160 },
              { kind:"backspace", count:1 }, { kind:"wait", ms:140 },
              { kind:"type", text:" «ТМЫВ ДЕНЕГ»" }
            ]},
            { steps:[
              { kind:"type", text:"Артем красавчик" }, { kind:"wait", ms:320 },
              { kind:"backspace", count:9 }, { kind:"wait", ms:240 },
              { kind:"type", text:" хочу ЗП 200" }, { kind:"wait", ms:260 },
              { kind:"backspace", count:3 }, { kind:"wait", ms:160 },
              { kind:"type", text:"600 000" }, { kind:"wait", ms:260 },
              { kind:"backspace", count:7 }, { kind:"wait", ms:180 },
              { kind:"backspace", count:999 }, { kind:"wait", ms:320 },
              ...tailFull
            ]},
            { steps:[
              { kind:"type", text:"МИША " },
              { kind:"wait", ms:200 },
              { kind:"typeStyled", text:"БАН", className:"ban" },
              { kind:"wait", ms:420 },
              { kind:"backspace", count:8 },
              { kind:"wait", ms:240 },
              ...tailFull
            ]},
          ];
          return scenarios[index] || { steps: tailFull };
        }

        function pickScenarioIndex(){
          const total = 11;
          let idx = Math.floor(Math.random() * total);
          if (total > 1 && idx === lastScenarioIndex) idx = (idx + 1) % total;
          lastScenarioIndex = idx;
          return idx;
        }

        function startScenarioTyping(){
          const logoPill = rootEl.querySelector("#logoPill");
          if (!logoPill) return;

          cancelStartDelay();
          stopTyping();
          isTyping = true;

          clearTokens();
          renderTokens();
          resetLogoFontSize();
          logoPill.classList.remove("is-revealed");

          const { steps } = getScenario(pickScenarioIndex());
          let idx = 0;

          const baseCharDelay = 55, jitter = 85;
          const longPauseChance = 0.12, longPauseExtra = 170;

          const baseBackDelay = 45, backJitter = 65;
          const longBackChance = 0.08, longBackExtra = 140;

          const runNext = () => {
            if (!isTyping) return;
            const step = steps[idx++];

            if (!step){
              typingTimer = setTimeout(() => {
                logoPill.classList.add("is-revealed");
                isTyping = false;
              }, 300);
              return;
            }

            if (step.kind === "wait"){
              typingTimer = setTimeout(runNext, step.ms);
              return;
            }

            if (step.kind === "type" || step.kind === "typeStyled"){
              const className = step.kind === "typeStyled" ? step.className : null;
              const chars = Array.from(step.text);
              let ci = 0;

              const typeChar = () => {
                if (!isTyping) return;
                if (ci >= chars.length){
                  typingTimer = setTimeout(runNext, 50);
                  return;
                }

                pushChar(chars[ci++], className);
                renderTokens();

                let d = baseCharDelay + Math.floor(Math.random() * jitter);
                if (Math.random() < longPauseChance) d += longPauseExtra;

                typingTimer = setTimeout(typeChar, d);
              };
              typeChar();
              return;
            }

            if (step.kind === "backspace"){
              let toDelete = step.count;
              const currentLen = tokens.reduce((s,t)=>s+t.text.length,0);
              if (toDelete >= 999) toDelete = currentLen;

              const backOne = () => {
                if (!isTyping) return;
                if (toDelete <= 0 || tokens.length === 0){
                  typingTimer = setTimeout(runNext, 50);
                  return;
                }

                popChar();
                renderTokens();
                toDelete--;

                let d = baseBackDelay + Math.floor(Math.random() * backJitter);
                if (Math.random() < longBackChance) d += longBackExtra;

                typingTimer = setTimeout(backOne, d);
              };
              backOne();
              return;
            }
          };

          runNext();
        }

        function stopTyping(){
          isTyping = false;
          if (typingTimer){ clearTimeout(typingTimer); typingTimer = null; }
        }

        function wireEvents() {
          rootEl.addEventListener("click", (e) => {
            const navItem = e.target.closest(".nav-item");
            if (navItem) {
              e.preventDefault();
              service.selectItem(navItem.dataset.id);
              return;
            }
            const collapseBtn = e.target.closest("#collapseBtn");
            if (collapseBtn) service.toggle();
          });
        }

        return { mount };
      }
      return { createView };
    })();

    function main() {
      const items = [
        { id: "cars",    label: "Поиск автомобилей", iconKey: "search" },
        { id: "content", label: "Контент",           iconKey: "folder" },
      ];

      const storageAdapter = SidebarInfra.createLocalStorageAdapter();
      const service = SidebarApp.createService({ storageAdapter });

      service.init({ items, defaultActiveId: "cars" });

      const root = document.getElementById("app");
      const view = SidebarUI.createView({ service });
      view.mount(root);
    }

    main();
  </script>
</body>
</html>
